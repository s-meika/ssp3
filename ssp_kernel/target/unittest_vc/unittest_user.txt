=====================================================================
                    SSPカーネル単体テスト (ssp-1.0.0対応）
                             Last Modified: '11/03/24
=====================================================================


○ 概要

SSPカーネル単体テストはSSPカーネルのターゲット非依存部が設計意図の通り
実装されていることを確認するためのものである．単体テストは回帰実行可能とし，
コードの追加/修正が追加/修正対象以外に影響していないかをチェックできるように
環境構築を行う．

単体テストでチェックできることは，記述したコードが意図通りに動作している
かであり，TOPPERS新世代カーネル統合仕様書で規定された動作が実装されている
こととは異なる．この観点においては別に仕様適合検査が必要であることに注意
すること．

○ テスト環境

単体テストはターゲット非依存部に対して行うため，テスト環境が整えやすい
ホスト環境上で行うこととする．

テスト環境は以下の通りである．カッコ内は実際のテストに使用した環境である．

・プログラム動作環境      ：Windows OS(Windows 7 Home Premium 64bit)
・コンパイラ/統合開発環境 ：Microsoft Visual Studio
                            (Microsoft Visual C++ 2008 Express Edition)
・テスト支援ツール        ：CUnit(CUnit 2.1.0)

○ テスト基準

テストコード中に設定したアサート(CU_ASSERT_XXX)を全てパスすること．

○ テスト実行方法

ソリューションファイルもしくはプロジェクトファイルを開き，ビルドを行う．
ビルドしてできたファイルを実行し，R(Run)でテストを行う．テスト結果が表示され，
Failureがなければテストは成功である．

ビルドの際はCUnitのインクルードディレクトリとライブラリディレクトリが
Visual Studioの設定に登録してある必要がある．
（ツール→オプションでオプション設定を開き，プロジェクト及びソリューションの
　VC++ディレクトリの中にあるインクルードファイル，ライブラリファイルの項目に
　CUnitのディレクトリを指定する）
CUnitは，http://cunit.sourceforge.net/からダウンロードできる．

○ テストカバレッジ測定

単体テストとは別に，ターゲット非依存部のコードパスが全てテストできていることを
確認するため，テストカバレッジ測定を実施する．

テストカバレッジはGCC環境で測定を行う(GCCは標準でテストカバレッジ測定に使用できる
プロファイル情報取得を行うことができる）．
また，LCOVを使用することにより測定結果を見やすく可視化することができる．

○ テストカバレッジ測定環境

テストカバレッジ測定環境は以下の通り．カッコ内は実際のテストに使用した環境である．

・プログラム動作環境      ：Windows OS + cygwin(Windows 7 Home Premium 64bit + cygwin)
・コンパイラ              ：gcc(gcc 3.4.4)
・測定結果可視化ツール    ：lcov 1.9

○ テストカバレッジ測定方法

cygwinでtarget/unittest_gccに移動し，

$ make depend
$ make

でビルドする．

$ ./ssptest.exe

でテストを実行し，単体テストと同様にRでテストを実行後，Qでテストを終了する．
カバレッジ測定結果が生成されているので，

$ make gencov

でカバレッジ測定結果がhtmlファイルとして生成される．
lcovはcygwinのインストーラに含まれないため，事前にインストールしておくこと．
lcovはhttp://ltp.sourceforge.net/coverage/lcov.phpからダウンロードできる．

以上．

